// via http://stackoverflow.com/a/17884754/3786947
angular.module('ShinyaApp.imageonloadDirective', [])
.directive('syImageonload', ['$rootScope', '$timeout', function ($rootScope, $timeout){
    return {
        restrict: 'A',
        link: function(scope, elem, attr) {
            elem.toggleClass('loding')
            elem.bind('load', function() {
                elem.toggleClass('loding')
                scope.$apply(function (){
                    scope.isImageLoaded = true
                })
            })
            elem.bind('error', function (){
                if (elem.attr('ng-class') === '{\'zoom_out\': isZoomIn && $index === now_zoom_id}'){
                    // #img_box
                    elem.attr('src', 'data:image/jpg;base64,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')
                } else {
                    // #img_fullscreen_box
                    // via http://stackoverflow.com/a/7719185/3786947
                    function loadScript(e,t){var a,n,r;n=!1,a=document.createElement("script"),a.type="text/javascript",a.src=e,a.onload=a.onreadystatechange=function(){n||this.readyState&&"complete"!=this.readyState||(n=!0,t())},r=document.getElementsByTagName("script")[0],r.parentNode.insertBefore(a,r)}
                    loadScript('/public/dist/vivus.min.js', function (){
                        elem.next().remove()
                        elem.replaceWith('<svg id="vivus_img_load_err" width="200" height="200" viewBox="0 0 530 531" xmlns="http://www.w3.org/2000/svg"><g fill="none"><path d="M51.249 150.754c-3.454-1.73-5.458-.099-4.478 3.638l.706 2.688c8.007 30.503-2.998 73.868-24.584 96.861l-.662.706c-2.644 2.816-1.65 5.288 2.192 5.521l136.651 8.259c9.377.567 23.956-2.028 32.559-5.794l21.283-9.316-13.767-18.806c-5.549-7.58-16.85-17.132-25.253-21.34l-124.647-62.418z" fill="#000"/><path d="M9.298 290.938c13.001 129.203 122.073 230.062 254.702 230.062 141.385 0 256-114.615 256-256s-114.615-256-256-256c-84.794 0-159.96 41.226-206.547 104.728" stroke="#000" stroke-width="17" stroke-linecap="round" stroke-linejoin="round"/><path d="M361.259 190.733c-4.06-1.129-8.339-1.733-12.759-1.733-26.234 0-47.5 21.266-47.5 47.5 0 4.115.523 8.109 1.507 11.917" stroke="#000" stroke-width="17" stroke-linecap="round"/><path d="M213.468 406.97c13.141-16.776 37.347-28.026 65.032-28.026 30.37 0 56.552 13.538 68.536 33.056" stroke="#000" stroke-width="17" stroke-linecap="round" stroke-linejoin="round"/></g></svg>')
                        new Vivus('vivus_img_load_err', {type: 'delayed', duration: 77, animTimingFunction: Vivus.EASE_OUT_BOUNCE})
                        scope.$apply(function (){
                            scope.isImageLoaded = true
                        })
                    })
                }
            })
        }
    }
}])
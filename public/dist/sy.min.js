angular.module("ShinyaApp",["ngRoute","ngTouch","ngAnimate","angular-jwt","angular-storage","ShinyaApp.posHelperServices","ShinyaApp.timeHelperServices","ShinyaApp.geoHelperServices","ShinyaApp.msgHelperServices","ShinyaApp.notifyDirective","ShinyaApp.autofocusDirective","ShinyaApp.hideKeyboardDirective","ShinyaApp.imageonloadDirective","ShinyaApp.autoscrollDirective","ShinyaApp.imgDirective","ShinyaApp.beepDirective","ShinyaApp.usercountDirective","ShinyaApp.submitController","ShinyaApp.chatController","ShinyaApp.forgotController","duScroll"]).config(["$routeProvider","$locationProvider","$httpProvider","jwtInterceptorProvider",function(e,t,o,r){t.html5Mode(!0),e.when("/",{templateUrl:"/public/js/templates/submit.html",controller:"submitController"}).when("/chat",{templateUrl:"/public/js/templates/chat.html",controller:"chatController"}).when("/forgot",{templateUrl:"/public/js/templates/forgot.html",controller:"forgotController"}).otherwise({redirectTo:"/"}),r.tokenGetter=["store",function(e){return e.get("id_token")}],o.interceptors.push("jwtInterceptor")}]).controller("rootController",["$rootScope","$scope","$timeout","$location","$route","$window","jwtHelper","store",function(e,t,o,r,i,n,a,c){function p(){var e=n.navigator.userAgent;return e.match(/Android/i)||e.match(/webOS/i)||e.match(/iPhone/i)||e.match(/iPad/i)||e.match(/iPod/i)||e.match(/BlackBerry/i)||e.match(/Windows Phone/i)?!0:!1}e.isMobile=p(),!n.navigator.standalone&&e.isMobile&&console.log("no fullscreen mode"),t.$on("$routeChangeStart",function(e,t,o,i){"/"===r.path()?c.get("id_token")&&(a.isTokenExpired(c.get("id_token"))||r.path("/chat").replace()):"/chat"===r.path()&&(c.get("id_token")?a.isTokenExpired(c.get("id_token"))&&r.path("/").replace():r.path("/").replace())}),t.$on("preTurnOnGeoServices",function(e){o(function(){t.$broadcast("turnOnGeoServices",e)},100)}),t.$on("preTurnOffGeoServices",function(e){o(function(){t.$broadcast("turnOffGeoServices",e)},100)})}]);
angular.module("ShinyaApp.autofocusDirective",[]).directive("syAutofocus",["$rootScope","$timeout",function(o,i){return{restrict:"A",link:function(t,u,c){o.isMobile||i(function(){u[0].focus()})}}}]);
angular.module("ShinyaApp.autoscrollDirective",[]).directive("syAutoscroll",["syPosHelper",function(o){return{restrict:"A",link:function(i,t,l){var n=o.getNowPos();t.bind("scroll",function(){var t=o.getNowPos();i.isScrollDown=t>=n&&o.getNowPos()>0?!0:!1,n=t,o.isBottom(i.isScrollDown)&&i.$apply(function(){i.viewedMsg(2)})})}}}]);
angular.module("ShinyaApp.beepDirective",[]).directive("syBeep",["$timeout","syPosHelper",function(o,e){return{restrict:"E",replace:!0,template:'<div class="all_notify_box general_animate" ng-if="!isViewMsg" id="notify_box"><span ng-click="viewedMsg(1)">{{msgNotifyBox.msg}}</span><audio ng-if="!isMuted" autoplay><source src="public/sound/beep.ogg" type="audio/ogg"><source src="public/sound/beep.m4a" type="audio/x-m4a"></audio><audio ng-if="isMuted" autoplay muted><source src="public/sound/beep.ogg" type="audio/ogg"><source src="public/sound/beep.m4a" type="audio/x-m4a"></audio></div>',controller:["$scope",function(t){function s(e){t.isAtMsgShow=!0;var s=document.getElementById(e);s.classList.add("atMsg"),o(function(){s.classList.remove("atMsg"),o(function(){t.isAtMsgShow=!1},717)},717)}function i(){if(t.isViewMsg=!0,t.contentItem){var o=e.getElemTopPos(t.contentItem)-e.chatBoxHeight/2;e.scrollToPos(o||null,t.isScrollDown),s(t.contentItem),t.contentItem=0}else e.scrollToPos(null,t.isScrollDown)}t.isViewMsg=!0,t.msgNotifyBox={},t.contentItem=0,t.isAtMsgShow=!1,t.viewedMsg=function(e){t.isChatBox?1===e?(t.isZoomIn=!1,i()):2===e&&(t.isViewMsg=!0):(t.isChatBox||t.toggleCurrentPage("infoBox"),t.isChatBox=!t.isChatBox,o(function(){i()}))},t.newMsgNotify=function(o,e,s){t.$apply(function(){"newMsg"===o?(t.msgNotifyBox={type:"newMsg",msg:e},t.isViewMsg=!1):"atMsg"===o&&(t.msgNotifyBox={type:"atMsg",msg:"@"+e+" 提到了你"},t.contentItem=s,t.isViewMsg=!1)})}}]}}]);
angular.module("ShinyaApp.hideKeyboardDirective",[]).directive("syHideKeyboard",["$rootScope",function(i){return{restrict:"A",link:function(e,n,r){var t=n.find("input");i.isMobile&&n.bind("submit",function(){t[0].blur()})}}}]);
angular.module("ShinyaApp.imageonloadDirective",[]).directive("syImageonload",["$rootScope","$timeout",function(A,e){return{restrict:"A",link:function(A,e,t){e.toggleClass("loding"),e.bind("load",function(){e.toggleClass("loding"),A.$apply(function(){A.isImageLoaded=!0})}),e.bind("error",function(){function t(A,e){var t,o,i;o=!1,t=document.createElement("script"),t.type="text/javascript",t.src=A,t.onload=t.onreadystatechange=function(){o||this.readyState&&"complete"!=this.readyState||(o=!0,e())},i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(t,i)}"{'zoom_out': isZoomIn && $index === now_zoom_id}"===e.attr("ng-class")?e.attr("src","data:image/jpg;base64,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"):t("/public/dist/vivus.min.js",function(){e.next().remove(),e.replaceWith('<svg id="vivus_img_load_err" width="200" height="200" viewBox="0 0 530 531" xmlns="http://www.w3.org/2000/svg"><g fill="none"><path d="M51.249 150.754c-3.454-1.73-5.458-.099-4.478 3.638l.706 2.688c8.007 30.503-2.998 73.868-24.584 96.861l-.662.706c-2.644 2.816-1.65 5.288 2.192 5.521l136.651 8.259c9.377.567 23.956-2.028 32.559-5.794l21.283-9.316-13.767-18.806c-5.549-7.58-16.85-17.132-25.253-21.34l-124.647-62.418z" fill="#000"/><path d="M9.298 290.938c13.001 129.203 122.073 230.062 254.702 230.062 141.385 0 256-114.615 256-256s-114.615-256-256-256c-84.794 0-159.96 41.226-206.547 104.728" stroke="#000" stroke-width="17" stroke-linecap="round" stroke-linejoin="round"/><path d="M361.259 190.733c-4.06-1.129-8.339-1.733-12.759-1.733-26.234 0-47.5 21.266-47.5 47.5 0 4.115.523 8.109 1.507 11.917" stroke="#000" stroke-width="17" stroke-linecap="round"/><path d="M213.468 406.97c13.141-16.776 37.347-28.026 65.032-28.026 30.37 0 56.552 13.538 68.536 33.056" stroke="#000" stroke-width="17" stroke-linecap="round" stroke-linejoin="round"/></g></svg>'),new Vivus("vivus_img_load_err",{type:"delayed",duration:77,animTimingFunction:Vivus.EASE_OUT_BOUNCE}),A.$apply(function(){A.isImageLoaded=!0})})})}}}]);
angular.module("ShinyaApp.imgDirective",[]).directive("syImg",function(){return{restrict:"E",replace:!0,template:'<div ng-if="now_img_list.length > 0" id="img_box" ng-class="{\'me\': isImgBoxRight, \'mobile\': isMobile}"><ul><li ng-repeat="url in now_img_list" class="general_animate"><img ng-src="{{url.small}}" ng-class="{\'zoom_out\': isZoomIn && $index === now_zoom_id}" ng-click="toggleImageSize(url, $index)" sy-imageonload></li></ul></div>',controller:["$scope","$window","$timeout",function(i,o,n){i.isZoomIn=!1,i.isImgBoxRight=!1,i.isImageLoaded=!1,i.img_list={},i.now_img_list=[],i.now_zoom_id=-1,i.imgURL="",i.toggleImgBox=function(o){var g=o.isMe,m=o.date;i.now_img_list!==i.img_list[m]&&angular.equals(i.now_img_list,[])?(i.isImgBoxRight=g,i.now_img_list=i.img_list[m]):i.now_img_list===i.img_list[m]||angular.equals(i.now_img_list,[])?i.now_img_list=[]:(i.now_img_list=[],n(function(){i.isImgBoxRight=g,i.now_img_list=i.img_list[m]},717))},i.toggleImageSize=function(o,g){o&&g!==i.now_zoom_id?(i.isZoomIn=!1,n(function(){i.isZoomIn=!0}),i.imgURL=o,i.now_zoom_id=g,i.isImageLoaded=!1):(i.isZoomIn=!1,i.now_zoom_id=-1)},i.openLink=function(i){o.open(i)}}]}});
angular.module("ShinyaApp.notifyDirective",[]).directive("syNotify",function(){return{restrict:"A",link:function(r,t,e){r.$watch("isMsgNotify",function(e){t.removeClass("submit_animate"),t.attr("type","button"),e?r.errMsg?(t.addClass("error_msg"),t.attr("value",r.errMsg)):r.okMsg?(t.addClass("ok_msg"),t.attr("value",r.okMsg)):console.error("[TypeError]: Not `error` or `ok`"):(t.removeClass("error_msg ok_msg").addClass("submit_animate"),t.attr({type:"submit",value:"提交"}))})}}});
angular.module("ShinyaApp.usercountDirective",[]).directive("syUsercount",function(){return{restrict:"E",template:'<div ng-if="!isMobile" id="userCount">在線人數：{{userCount}}</div>',controller:["$scope",function(n){n.userCount=0,n.onlineUser=[],n.onUserIO=function(e){n.$apply(function(){n.userCount=e.count,n.onlineUser=e.onlineUser})}}]}});
angular.module("ShinyaApp.geoHelperServices",[]).service("syGeoHelper",function(){function n(n,i,o,t,e){var c=Math.PI*n/180,p=Math.PI*o/180,y=(Math.PI*i/180,Math.PI*t/180,i-t),r=Math.PI*y/180,a=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos(r);return a=Math.acos(a),a=180*a/Math.PI,a=60*a*1.1515,"K"==e&&(a=1.609344*a),"N"==e&&(a=.8684*a),a}var i={200:{type:"lightning",icon:"lightning"},201:{type:"lightning",icon:"lightning"},202:{type:"lightning",icon:"lightning"},210:{type:"lightning",icon:"lightning"},211:{type:"lightning",icon:"lightning"},212:{type:"lightning",icon:"lightning"},221:{type:"lightning",icon:"lightning"},230:{type:"lightning",icon:"lightning"},231:{type:"lightning",icon:"lightning"},232:{type:"lightning",icon:"lightning"},300:{type:"rain",icon:"drizzle"},301:{type:"rain",icon:"drizzle"},302:{type:"rain",icon:"drizzle"},310:{type:"rain",icon:"drizzle"},311:{type:"rain",icon:"drizzle"},313:{type:"rain",icon:"showers"},314:{type:"rain",icon:"showers"},321:{type:"rain",icon:"showers"},500:{type:"rain",icon:"rain"},501:{type:"rain",icon:"rain"},502:{type:"rain",icon:"downpour"},503:{type:"rain",icon:"downpour"},504:{type:"rain",icon:"downpour"},511:{type:"rain",icon:"flurries"},520:{type:"rain",icon:"showers"},521:{type:"rain",icon:"showers"},522:{type:"rain",icon:"showers"},531:{type:"rain",icon:"showers"},600:{type:"snow",icon:"snow"},601:{type:"snow",icon:"snow"},602:{type:"snow",icon:"snow"},611:{type:"snow",icon:"sleet"},612:{type:"snow",icon:"sleet"},615:{type:"snow",icon:"sleet"},616:{type:"snow",icon:"sleet"},620:{type:"snow",icon:"sleet"},621:{type:"snow",icon:"sleet"},622:{type:"snow",icon:"sleet"},701:{type:"fog",icon:"fog"},711:{type:"fog",icon:"haze"},721:{type:"fog",icon:"haze"},731:{type:"fog",icon:"haze"},741:{type:"fog",icon:"fog"},751:{type:"fog",icon:"fog"},761:{type:"fog",icon:"fog"},771:{type:"fog",icon:"tornado"},781:{type:"fog",icon:"tornado"},800:{type:"sun",icon:"sun"},801:{type:"sun",icon:"sun"},802:{type:"clouds",icon:"cloud"},803:{type:"clouds",icon:"cloud"},804:{type:"clouds",icon:"cloud"},900:{type:"wind",icon:"tornado"},901:{type:"wind",icon:"tornado"},902:{type:"wind",icon:"tornado"},903:{type:"wind",icon:"thermometer low"},904:{type:"wind",icon:"thermometer full"},905:{type:"wind",icon:"wind"},906:{type:"wind",icon:"hail"},951:{type:"wind",icon:"wind"},952:{type:"wind",icon:"wind"},953:{type:"wind",icon:"wind"},954:{type:"wind",icon:"wind"},955:{type:"wind",icon:"wind"},956:{type:"wind",icon:"tornado"},957:{type:"wind",icon:"tornado"},958:{type:"wind",icon:"tornado"},959:{type:"wind",icon:"tornado"},960:{type:"wind",icon:"tornado"},961:{type:"wind",icon:"tornado"},962:{type:"wind",icon:"tornado"}};this.getCityWeatherType=function(n){return n in i?i[n].type:"others"},this.getGeoWeatherType=function(n,o){return n in i?o?i[n].icon+" moon":i[n].icon+" sun":"cloud refresh"},this.getDistance=function(i,o){var t=~~n(i.lat,i.lon,o.lat,o.lon,"K");return t?t+" km":"0 km"}});
angular.module("ShinyaApp.msgHelperServices",[]).service("syMsgHelper",function(){function e(e,n){return e.replace(/square|thumbnail|thumb150|bmiddle|mw600|large/,n)}var n=Date.now();this.isShowDate=function(e){return e-n>6e4?(n=Date.now(),!0):!1},this.msgSanitization=function(e,n){for(var r=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","廿","廿一","廿二","廿三","廿四","廿五","廿六","廿七","廿八","廿九","卅","卅一","卅二","卅三","卅四","卅五","卅六","卅七","卅八","卅九"],i=n.length,a=0;i>a;a++)e=e.replace(n[a],"[圖"+(r[a]?r[a]:" "+(a+1))+"]");return e},this.imgSanitization=function(n){for(var r=[],i=n.length,a=0;i>a;a++)r.push(n.indexOf(!1)?{small:e(n[a],"square"),medium:e(n[a],"bmiddle"),large:e(n[a],"large")}:{small:n[a],medium:n[a],large:n[a]});return r}});
angular.module("ShinyaApp.posHelperServices",[]).service("syPosHelper",["$rootScope",function(t){this.nowPos=0,this.chatBoxHeight=document.getElementById("chat_box").clientHeight,this.storeNowPos=function(){this.nowPos=document.getElementById("chat_box").scrollTop},this.getNowPos=function(){return document.getElementById("chat_box").scrollTop},this.getElemTopPos=function(t){return document.getElementById(t).offsetTop},this.getElemBottomPos=function(t){return document.getElementById(t).offsetTop+document.getElementById(t).clientHeight},this.setNowPos=function(t){document.getElementById("chat_box").scrollTop=t},this.getBottomPos=function(){var t=document.getElementById("chat_box");return t.scrollHeight-t.clientHeight},this.isBottom=function(){var t=document.getElementById("chat_box");return t.scrollHeight-t.clientHeight-t.scrollTop<=0},this.scrollToPos=function(e,o){var n=e||this.getBottomPos();t.isMobile?this.setNowPos(n):angular.element(document.getElementById("chat_box")).scrollTo(0,n,171).then(function(){o=!1})}}]);
angular.module("ShinyaApp.timeHelperServices",[]).service("syTimeHelper",function(){this.partsOfADay=function(e){return 3>=e?"深夜":6>=e?"破曉":9>=e?"早晨":12>=e?"午前":15>=e?"午後":18>=e?"傍晚":21>=e?"薄暮":"深夜"},this.getNumero=function(e){return 77>e?"gold":177>e?"aluminum":"steel"},this.getDaytimeOrNight=function(e){return e>6&&18>e?"daytime":"night"},this.isSameDay=function(e,t){var e=new Date(e),t=new Date(t);return getTodayMs=function(e){return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())},getTodayMs(e)===getTodayMs(t)}});
angular.module("ShinyaApp.chatController",[]).controller("chatController",["$rootScope","$scope","$http","$timeout","$window","$location","$filter","jwtHelper","store","syPosHelper","syTimeHelper","syGeoHelper","syMsgHelper",function(e,t,o,s,n,i,a,g,r,c,l,u,m){function x(e){o.post("/api/getSelectedDateNews",{selectDate:t.selectDate,timezoneOffset:t.timezoneOffset}).success(function(t,o,s,n){e("ok",t.msg)}).error(function(t,o,s,n){401===o?i.path("/").replace():e("error",t.msg)})}function f(o){var s=e.socket.id===o.id,n=c.isBottom(t.isScrollDown)||t.isScrollDown;t.$apply(function(){t.msgInbox.push({isMe:s,isImg:o.img_list.length>0,isShowDate:m.isShowDate(o.date),date:o.date,msg:m.msgSanitization(o.msg,o.img_list),username:o.username}),o.img_list.length>0&&(t.img_list[o.date]=m.imgSanitization(o.img_list))}),(n||s)&&t.isChatBox?c.scrollToPos():o.at&&o.at.indexOf("@"+B.username)>=0?t.newMsgNotify("atMsg",o.username,o.date):s||t.contentItem||t.newMsgNotify("newMsg","新消息"),t.msgPosInfo.push({id:o.date,topPos:c.getElemTopPos(o.date),bottomPos:c.getElemBottomPos(o.date)})}function d(){e.socket=io(":80",{query:"token="+w}),e.socket.on("connect",function(){e.socket.emit("latestMsg",t.msgInbox.length>=0),e.socket.on("latestMsg",function(e){for(var o=e.length,s=0;o>s;s++)t.$apply(function(){t.msgInbox.push({isMe:B.username===e[s].username,isImg:e[s].img_list.length>0,isShowDate:0===s?!0:!1,date:e[s].date,msg:m.msgSanitization(e[s].msg,e[s].img_list),username:e[s].username}),e[s].img_list.length>0&&(t.img_list[e[s].date]=m.imgSanitization(e[s].img_list))}),t.msgPosInfo.push({id:e[s].date,topPos:c.getElemTopPos(e[s].date),bottomPos:c.getElemBottomPos(e[s].date)})})}),e.socket.on("textMsg",function(e){f(e)}),e.socket.on("userJoin",function(e){t.onUserIO(e)}),e.socket.on("disconnect",function(e){t.onUserIO(e)})}function h(){console.log("reconnect"),e.socket.disconnect(),e.socket.connect(":80"),e.socket.on("textMsg",function(e){f(e)})}t.isChatBox=!0,t.isSun="daytime"===l.getDaytimeOrNight((new Date).getHours())?!0:!1,t.isInfoBox=!1,t.toggleChatBox=function(e){e?"left"===e?t.isChatBox&&(t.isChatBox=!t.isChatBox):"right"===e&&(t.isChatBox||"infoBox"!==t.currentPage?t.toggleCurrentPage("infoBox"):t.isChatBox=!t.isChatBox):(t.isChatBox||t.toggleCurrentPage("infoBox"),t.isChatBox=!t.isChatBox,t.isSun=!t.isSun),t.now_img_list=[],t.isZoomIn=!1},t.currentPage="infoBox",t.toggleCurrentPage=function(e){s(function(){t.currentPage=e})};var w=r.get("id_token"),B=g.decodeToken(w);console.log(B),t.infoBox={title:"加入於",username:B.username,numero:B.numero,date:a("date")(B.date,"yyyy 年 M 月 d 日"),partsOfADay:l.partsOfADay(~~a("date")(B.date,"H")),weather:B.weather.description},t.numero=l.getNumero(t.infoBox.numero),t.getDaytimeOrNight=l.getDaytimeOrNight(~~a("date")(B.date,"H")),t.partWeather="",t.togglePartWeather=function(){t.partWeather==u.getCityWeatherType(B.weather.code)?(t.partWeather="",s(function(){t.infoBox.title="加入於"},777)):(t.partWeather=u.getCityWeatherType(B.weather.code),s(function(){t.infoBox.title="當日天氣"},777))},t.isNewsExist=!1,t.toggleNewsExist=function(){t.isNewsExist=!t.isNewsExist},t.newsBox={},t.selectDateNewsBox=[],t.timezoneOffset=(new Date).getTimezoneOffset()/60,t.selectDate=(new Date).getHours(),t.getSelectedDateNews=function(){t.selectDate in t.newsBox?(t.selectDateNewsBox=t.newsBox[t.selectDate],"infoBox"===t.currentPage&&t.toggleCurrentPage("newsBox"),t.isNewsExist||t.toggleNewsExist()):(t.toggleCurrentPage("loadBox"),x(function(e,o){"ok"===e?(t.newsBox[t.selectDate]=o,t.selectDateNewsBox=t.newsBox[t.selectDate],"loadBox"===t.currentPage&&t.toggleCurrentPage("newsBox"),t.isNewsExist||t.toggleNewsExist()):("loadBox"===t.currentPage&&t.toggleCurrentPage("newsBox"),t.isNewsExist&&t.toggleNewsExist())}))},t.previousHour=function(){t.selectDate>1?(t.selectDate--,t.getSelectedDateNews()):(t.selectDate=24,t.getSelectedDateNews())},t.nextHour=function(){t.selectDate<24?(t.selectDate++,t.getSelectedDateNews()):(t.selectDate=1,t.getSelectedDateNews())},t.gotoSettingBox=function(){"infoBox"===t.currentPage&&t.toggleCurrentPage("settingBox")},t.isMuted=!!r.get("isMuted"),t.toggleMuted=function(){t.isMuted=!t.isMuted,r.set("isMuted",t.isMuted)},t.quit=function(){r.remove("id_token"),r.remove("isGeoServices"),e.socket.disconnect(),i.path("/")},t.isGeoServices=r.get("isGeoServices")||B.isGeoServices,t.toggleGeoServices=function(){o.post("/api/toggleGeoServices",{isGeoServices:!t.isGeoServices}).success(function(e,o,s,n){"on"===e.msg?(r.set("isGeoServices",!0),t.$emit("preTurnOnGeoServices","驗證身份以開啟服務")):(r.set("isGeoServices",!1),t.$emit("preTurnOffGeoServices","驗證身份以關閉服務")),t.quit()}).error(function(e,t,o,s){401===t&&i.path("/")})},t.geoBox={},t.weatherBox={},t.isSameDay=!1,t.getGeoServices=function(){t.isGeoServices?t.geoBox.distance?"infoBox"===t.currentPage&&t.toggleCurrentPage("geoBox"):("infoBox"===t.currentPage&&t.toggleCurrentPage("loadBox"),n.navigator.geolocation.getCurrentPosition(function(e){console.log(e.coords.latitude,e.coords.longitude),o.post("/api/getGeoServices",{coords:{lat:e.coords.latitude,lon:e.coords.longitude}}).success(function(e,o,s,n){var i=e.msg.last_geo.weather.code,a=e.msg.last_geo.weather.isNight,g=e.msg.now_geo.weather.code,r=e.msg.now_geo.weather.isNight;last_weather=u.getGeoWeatherType(i,a),now_weather=u.getGeoWeatherType(g,r),t.geoBox=e.msg,t.geoBox.distance=u.getDistance(e.msg.last_geo,e.msg.now_geo),t.weatherBox={last_weather:last_weather,now_weather:now_weather},t.isSameDay=l.isSameDay(t.geoBox.now_geo.date,t.geoBox.last_geo.date),"loadBox"===t.currentPage&&t.toggleCurrentPage("geoBox")}).error(function(e,t,o,s){401===t&&i.path("/")})})):"infoBox"===t.currentPage&&t.toggleCurrentPage("geoBox")},t.atUser=[],t.isUserOnline=function(e){return t.onlineUser.indexOf(e.slice(1))>=0},t.$watch("msgOutbox.textMsg",function(e,o){var s=e.match(/\@([^\s\@]){1,16}/g);if(s&&s!==t.atUser){for(var n=s.length,i=0;n>i;i++)t.atUser.indexOf(s[i])<0&&t.atUser.push(s[i]);for(var a=t.atUser.length,i=0;a>i;i++)s.indexOf(t.atUser[i])<0&&t.atUser.splice(i,1)}else t.atUser=[]}),t.msgInbox=[],t.msgOutbox={textMsg:""},t.msgPosInfo=[],t.emitTextMsg=function(){var o=t.msgOutbox.textMsg.match(/\@([^\s\@]){1,16}/g);""!==t.msgOutbox.textMsg&&(e.socket.emit("textMsg",{id:e.socket.id,msg:t.msgOutbox.textMsg,username:t.infoBox.username,at:o}),t.atUser="",t.msgOutbox.textMsg=""),t.isZoomIn=!1},e.socket?h():d()}]);
angular.module("ShinyaApp.forgotController",[]).controller("forgotController",["$scope","$http","$timeout","$location",function(o,t,r,s){o.isMsgNotify=!1,o.errMsg="",o.okMsg="",o.msgNotify=function(t,s){"error"===t?(o.input_shake_animate=!0,o.errMsg=s,o.isMsgNotify=!0,r(function(){o.errMsg="",o.input_shake_animate=!1,o.isMsgNotify=!1},1717)):"ok"===t?(o.okMsg=s,o.isMsgNotify=!0,r(function(){o.okMsg="",o.isMsgNotify=!1},1717)):console.error("[TypeError]: Not `error` or `ok`")},o.forgot={},o.step=1,o.returnToPreviousStep=function(){1===o.step?s.path("/"):o.step=o.step-1},o.gotoStepThree=function(){o.step=3,o.msgNotify("ok","請輸入新密碼")},o.forgotEmailSubmit=function(){t.post("/forgot_email",{email:o.forgot.email}).success(function(t,r,s,e){o.step=2,o.msgNotify("ok",t.msg)}).error(function(t,r,s,e){o.msgNotify("error",t.msg)}),o.forgot={}},o.forgotCodeSubmit=function(){t.post("/forgot_code",{code:o.forgot.code,password:o.forgot.password}).success(function(t,e,i,n){o.msgNotify("ok",t.msg),r(function(){s.path("/")},2e3)}).error(function(t,r,s,e){o.msgNotify("error",t.msg)}),o.forgot={}}}]);
angular.module("ShinyaApp.submitController",[]).controller("submitController",["$scope","$http","$timeout","$location","$route","$window","jwtHelper","store",function(o,i,t,e,r,s,n,g){o.isMsgNotify=!1,o.errMsg="",o.okMsg="",o.msgNotify=function(i,e){"error"===i?(o.input_shake_animate=!0,o.errMsg=e,o.isMsgNotify=!0,t(function(){o.errMsg="",o.input_shake_animate=!1,o.isMsgNotify=!1},1717)):"ok"===i?(o.okMsg=e,o.isMsgNotify=!0,t(function(){o.okMsg="",o.isMsgNotify=!1},1717)):console.error("[TypeError]: Not `error` or `ok`")},g.get("id_token")&&n.isTokenExpired(g.get("id_token"))&&t(function(){o.msgNotify("ok","請重新登錄")},0),o.$on("turnOnGeoServices",function(i){t(function(){o.msgNotify("ok","驗證身份以開啟服務")},0)}),o.$on("turnOffGeoServices",function(i){t(function(){o.msgNotify("ok","驗證身份以取消服務")},0)}),o.isLogin=!0,o.toggleSubmit=function(){o.isLogin=!o.isLogin},o.login={},o.register={},o.loginSubmit=function(){i.post("/login",{user:o.login.user,password:o.login.password}).success(function(o,i,t,r){g.set("id_token",o.token),e.path("/chat").replace()}).error(function(i,t,e,r){o.msgNotify("error",i.msg)}),o.login={}},o.registerSubmit=function(){i.post("/register",{username:o.register.username,email:angular.lowercase(o.register.email),password:o.register.password}).success(function(i,t,e,r){o.msgNotify("ok",i.msg),o.toggleSubmit()}).error(function(i,t,e,r){o.msgNotify("error",i.msg)}),o.register={}}}]);
//# sourceMappingURL=sy.min.js.map